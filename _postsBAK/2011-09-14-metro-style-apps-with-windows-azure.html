--- 
layout: post
title: Metro Style Apps with Windows Azure
categories: 
- Access Control Service
- Azure
- Windows 8
- Windows Azure
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "1"
  _topsy_long_url: http://www.wadewegner.com/2011/09/metro-style-apps-with-windows-azure/
  topsy_short_url: http://bit.ly/qTIt7r
  dsq_thread_id: "609465187"
---
<p>I love building keynote applications! I had the great fortune to work with <a href="http://www.microsoft.com/presspass/exec/techfellow/Shewchuk/default.mspx" target="_blank">John Shewchuk</a> – Technical Fellow at Microsoft – as he demonstrated a vision for how identity in Windows Azure can enable great experiences in Windows 8. I wanted to quickly provide some background on the components of the sample application he showed called <strong>Margie’s Travel</strong>.</p>  <p>Margie’s Travel is a sample travel application that demonstrates how you can track and manage your trips across multiple Windows 8 machines using a combination of technologies in Windows Azure and Windows 8.</p>  <p>The application is a Metro styled app built on HTML5, CSS, and JavaScript. Additionally, this application was rapidly built by using the templates and samples found in the <a href="http://watwindows8.codeplex.com/" target="_blank">Windows Azure Toolkit for Windows 8</a>.</p>  <p>When the application is launched, the user needs to login. Rather than creating yet another identity store, or mapping directly to a specific identity provider, Margie’s Travel uses the <a href="http://www.microsoft.com/windowsazure/features/accesscontrol/" target="_blank">Windows Azure Access Control Service</a>.</p>  <p><a href="http://images.wadewegner.com/wordpress/2011/09/Image1_thumb3.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Margie&#39;s Travel" border="0" alt="Margie&#39;s Travel" src="http://images.wadewegner.com/wordpress/2011/09/Image1_thumb3_thumb.png" width="642" height="349" /></a></p>  <p>When you click the login button, the application first checks the Windows PasswordVault to see if the credential (which includes the token) exists:</p>  <pre class="code"><span style="color: blue">var </span>vault = <span style="color: blue">new </span>Windows.Security.Credentials.PasswordVault();
<span style="color: blue">var </span>cred = vault.retrieve(url, username);</pre>

<p>If this exists, the application will login.&#160; If not, the the application calls out to the Access Control Service to get a list of identity providers from which the user can select.</p>

<p><a href="http://images.wadewegner.com/wordpress/2011/09/Image2_thumb1.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Windows Azure Access Control Service" border="0" alt="Windows Azure Access Control Service" src="http://images.wadewegner.com/wordpress/2011/09/Image2_thumb1_thumb.png" width="242" height="147" /></a></p>

<p>This code is also very simple to write in JavaScript:</p>

<pre class="code"><span style="color: blue">var </span>request = <span style="color: blue">new </span>XMLHttpRequest();
request.open(<span style="color: maroon">&quot;GET&quot;</span>, IPSFeedURL(<span style="color: maroon">&quot;https://ACSNAMESPACE.accesscontrol.windows.net&quot;</span>), <span style="color: blue">false</span>);
request.send(<span style="color: blue">null</span>);
<span style="color: blue">var </span>jsonString = request.responseText;
<span style="color: blue">var </span>jsonlist = ParseIPList(jsonString);

BindJsonToList(jsonlist);</pre>

<p>Once the users makes the selection, the Windows Web Authentication Broker invoked. This allows us to use a consistent and secure method for handling authentication. The login page for the selected identity provider is rendered in the broker.</p>

<p><a href="http://images.wadewegner.com/wordpress/2011/09/Image3_thumb2.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Windows Web Auth Broker" border="0" alt="Windows Web Auth Broker" src="http://images.wadewegner.com/wordpress/2011/09/Image3_thumb2_thumb.png" width="642" height="395" /></a></p>

<p>Once the user logs in, the Access Control Service token is return to the Web Auth Broker. The application is able to take the credential and store it into the Windows Web Vault. This gives us a consistent SSO experience so that upon subsequent launches thee user does not need to log in again.</p>

<p>To store the credential, we simply take the various components, create a new PasswordCredential, and add it to the vault.</p>

<pre class="code"><span style="color: blue">var </span>cred = <span style="color: blue">new </span>Windows.Security.Credentials.PasswordCredential(
    url,
    username,
    token);
vault.add(cred);</pre>

<p>Furthermore, since the Web Broker can synchronize across trusted devices using Windows Live, the token is automatically synchronized to any trusted device so that you can get SSO across multiple devices.</p>

<p><a href="http://images.wadewegner.com/wordpress/2011/09/Image4_thumb1.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Rich Data in Margie&#39;s Travel" border="0" alt="Rich Data in Margie&#39;s Travel" src="http://images.wadewegner.com/wordpress/2011/09/Image4_thumb1_thumb.png" width="646" height="353" /></a></p>

<p>Once logged in, the application will call out to additional Web services in Windows Azure (like the GetTravelerInfo() method) so that we can validate the users credentials before returning the results.</p>

<p>In addition, this token can be used to call out to additional services in Windows Azure, to get rich pictures from Bing, specific data from the Windows Azure DataMarket and Wolfram Alpha, and even weather information.</p>

<p><a href="http://images.wadewegner.com/wordpress/2011/09/Image5_thumb1.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Data from Windows Azure DataMarket and Bing" border="0" alt="Data from Windows Azure DataMarket and Bing" src="http://images.wadewegner.com/wordpress/2011/09/Image5_thumb1_thumb.png" width="646" height="353" /></a></p>

<p>All of this is made possible by unique features and capabilities provided by Windows Azure and Windows 8.</p>

<p>If you want to give this a try, and learn more about how all this works, download the <a href="http://watwindows8.codeplex.com/" target="_blank">Windows Azure Toolkit for Windows 8</a>. Additionally, take a look at posts by <a href="http://blogs.msdn.com/b/windowsazure/archive/2011/09/14/announcing-the-windows-azure-toolkit-for-windows-8.aspx" target="_blank">Nick Harris</a> and <a href="http://blogs.msdn.com/b/vbertocci/archive/2011/09/14/using-acs-in-metro-style-applications.aspx" target="_blank">Vittorio Bertocci</a>.</p>

<p>I hope this helps!</p>
