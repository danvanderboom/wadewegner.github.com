--- 
layout: post
title: Running a PHP application on Windows Azure
categories: 
- Azure
- PHP
- Windows Azure
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "1"
  aktt_notify_twitter: "yes"
  _sexybookmarks_shortUrl: http://bit.ly/azLuQo
  _sexybookmarks_permaHash: 4269ddf091dcc7aff310a11b0a80fd21
  dsq_thread_id: "609465514"
---
I recently returned from <a href="http://live.visitmix.com/" target="_blank">MIX09</a> – what a fantastic event! So many great things were announced; so many that there’s no way I can list them all here. Please visit <a href="http://live.visitmix.com/" target="_blank">http://live.visitmix.com/</a> for access to the keynote videos and all the breakout sessions. I would also recommend reading the <a href="http://archive.visitmix.com/blogs/News/MIX08-Day-1-Keynote-Recap/" target="_blank">day one recap</a> and the <a href="http://www.visitmix.com/Opinions/MIX09-Keynote-and-Partner-Highlights" target="_blank">day two recap</a>.

One of the major announcements was new capabilities for the Windows Azure CTP. This includes the support for FastCGI, Full Trust, and Geo-location. Please take a look at the <a href="http://blogs.msdn.com/windowsazure/archive/2009/03/18/windows-azure-delivers-new-ctp-capabilities.aspx" target="_blank">Windows Azure team’s blog for all the announcements</a>.

In this post, I want to walk you through the step you need to take to run a PHP application on Windows Azure. As you’ll see, it’s quite simple and straightforward – after a few configuration updates and additional steps, you can run nearly any PHP application. This walkthrough assumes that you have installed the latest bits for Windows Azure. If you are just getting started with Azure, please visit <a href="http://www.azure.com/" target="_blank">http://www.azure.com/</a> – this is the primary landing page for the Azure Services Platform. If you want to get the updated bits that allows for Full Trust and FastCGI, you can grab the bits at the <a href="http://www.microsoft.com/downloads/details.aspx?familyid=59E8FC0C-C399-4AB7-8A93-882D8E74B67A&amp;displaylang=en" target="_blank">Windows Azure Tools for Microsoft Visual Studio March 2009 CTP page</a>.
<ol>
	<li>Create a new project. Select <strong>File</strong> –&gt; <strong>New</strong> –&gt; <strong>Project</strong>.</li>
	<li>Select <strong>Cloud Service</strong> project type and select the <strong>Blank Cloud Service</strong> template. Specify the name/location, and click <strong>OK</strong>.
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_4.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="New Windows Azure project" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_1.png" border="0" alt="New Windows Azure project" /></a></li>
	<li>Add a <strong>Cgi Web Role </strong>project. Right-click the project (e.g. CloudService1) and select <strong>New Web Role Project</strong>.
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_6.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Add a web role project" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_2.png" border="0" alt="Add a web role project" /></a></li>
	<li>Specify the <strong>Name</strong> and click <strong>OK</strong>.
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_8.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Add a CGI web role" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_3.png" border="0" alt="Add a CGI web role" /></a></li>
	<li>By default the <strong>Web.roleconfig</strong> file is opened in the new project. Remove the comments and update the <strong>application fullPath </strong>to "%RoleRoot%phpphp-cgi.exe".
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_10.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_4.png" border="0" alt="image" /></a></li>
	<li>Now we need to actually grab the PHP executable that will bet invoked. Browse to <a title="http://www.php.net/downloads.php" href="http://www.php.net/downloads.php" target="_blank">http://www.php.net/downloads.php</a> and grab the non-thread-safe Windows binary (at the time of writing, it is “PHP 5.2.9-1 Non-thread-safe zip package”).</li>
	<li>You might as well configure PHP to run on your Windows environment. Rather than specifying all these steps, please see <a href="http://simonguest.com/blogs/smguest/archive/2009/03/09/Using-Windows-7-to-host-PHP-applications-in-5-easy-steps_2100_.aspx" target="_blank">Simon Guest’s post on hosting PHP applications in 5 easy steps</a>. Follow the steps in his post, and at the end you should be able to confirm that PHP works in IIS 7.</li>
	<li>Copy all the files in the PHP folder you downloaded into your Cgi Web Role project. XCopy works really well. For example, open a command prompt in the root of your Cgi Web Role project and type:
<span style="font-family: Cordia New; font-size: medium;"><span style="font-family: Courier New; font-size: x-small;"><strong>xcopy /s php php</strong></span>
</span>When asked, specify “D for directory”. This will copy everything from c:php into a folder called php in your Cgi Web Role project. Note that this is where we pointed Windows Azure to in step 5.</li>
	<li>Select your Cgi Web Role project, show all files, and add the new php folder into your project. This way it will get packaged up with the rest of your application and deployed to Windows Azure.</li>
	<li>Open up the <strong>Web.config</strong> file and specify a new default document. This will tell Windows Azure to open up our PHP page by default. Under the <span style="font-family: Courier New;">&lt;system.webServer&gt;</span> element, add a <span style="font-family: Courier New;">&lt;defaultDocument&gt;</span>:
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_12.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="defaultDocument" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_5.png" border="0" alt="defaultDocument" /></a></li>
	<li>Additionally, we need to setup a handler in the Web.config file. Add the following code to the &lt;handlers&gt; element in the web.Config: <a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_22.png"><img class="alignnone size-full wp-image-285" title="FastCGI" src="http://www.wadewegner.com/wp-content/uploads/2009/03/FastCGI.jpg" alt="FastCGI" width="413" height="120" /></a></li>
	<li>In order for this to function, we have to enable native code execution in Windows Azure. To do so, open the <strong>ServiceDefinition.csdef</strong> file and set the <strong>enableNativeCodeExecutiion</strong> flag to true:
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_14.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="enableNativeCodeExecution" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_6.png" border="0" alt="enableNativeCodeExecution" /></a></li>
	<li>Now, let’s create a new PHP file. Right-click on your Cgi Web Role and add a new item. Select the Text File template and change the name to index.php. Click <strong>Add</strong>.
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_16.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="index.php" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_7.png" border="0" alt="index.php" /></a></li>
	<li>To test, create some PHP code. A quick, but effective, test is to simply echo “Hello World”. In the index.php file, write the following code:
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_18.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="hello world" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_8.png" border="0" alt="hello world" /></a></li>
	<li>Press F5, and your browser should open and show you the following page:
<a href="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_20.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="Hello World!" src="http://images.wadewegner.com/wordpress/content/binary/WindowsLiveWriter/RunningaPHPapplicationonWindowsAzure_E6D6/image_thumb_9.png" border="0" alt="Hello World!" /></a></li>
</ol>
And that’s all it takes!

While this is a simple demonstration, I hope it impresses upon you the impact that allowing native code execution has in Windows Azure. With native code execution, and fast CGI support, you can now leverage all the rich content created in the PHP community on Windows Azure. The story even gets better with the new relational capabilities of SQL Data Services, but I’ll save that for another post.

I hope this helps!
