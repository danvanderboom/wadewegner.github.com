--- 
layout: post
title: AutoStart WCF Services to Expose them as Service Bus Endpoints
categories: 
- Autostart
- Service Bus
- WCF
- Windows Azure AppFabric
- Windows Server AppFabric
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "1"
  disable_wpautop: "0"
  disable_wptexturize: "0"
  disable_convert_chars: "0"
  disable_convert_smilies: "0"
  dsq_thread_id: "609465533"
---
<p>A couple months ago I wrote a post on how to host <a href="http://www.wadewegner.com/2010/05/host-wcf-services-in-iis-with-service-bus-endpoints/" target="_blank">WCF services in IIS that expose themselves as endpoints on the Windows Azure AppFabric Service Bus</a>.&#160; The principal challenge in this scenario is that IIS/WAS relies on message-based activation and will only launch the host after the first request comes in.&#160; However, until the host is launched the service will not connect to the Service Bus, and consequently will never receive a message.&#160; A classic <a href="http://dictionary.reference.com/browse/Catch-22" target="_blank">catch-22</a>.</p>  <p>The solution I proposed was to leverage the Application Warm-Up Extension for IIS 7.5, which will proactively load and initialize processes before the first request arrives.&#160; While this is acceptable, I’ve found a better solution using the Windows Server AppFabric Autostart (thanks to conversations with <a href="blogs.msdn.com/b/rjacobs" target="_blank">Ron Jacobs</a>).</p> <!--start_raw--><object data="data:application/x-silverlight," type="application/x-silverlight" width="490" height="350">     <param name="source" value="http://www.wadewegner.com/MediaPlayerTemplate.xap" />     <param name="onerror" value="onSilverlightError" />     <param name="autoUpgrade" value="true" />     <param name="minRuntimeVersion" value="3.0.40624.0" />                 <param name="enableHtmlAccess" value="true" />     <param name="enableGPUAcceleration" value="true" />     <param name="initparams" value="playerSettings = 
                &lt;Playlist&gt;
                    &lt;AutoLoad&gt;false&lt;/AutoLoad&gt;
                    &lt;AutoPlay&gt;false&lt;/AutoPlay&gt;
                    &lt;DisplayTimeCode&gt;false&lt;/DisplayTimeCode&gt;
                    &lt;EnableCachedComposition&gt;true&lt;/EnableCachedComposition&gt;
                    &lt;EnableCaptions&gt;false&lt;/EnableCaptions&gt;
                    &lt;EnableOffline&gt;false&lt;/EnableOffline&gt;
                    &lt;EnablePopOut&gt;true&lt;/EnablePopOut&gt;
                    &lt;StartMuted&gt;false&lt;/StartMuted&gt;
                    &lt;StretchMode&gt;None&lt;/StretchMode&gt;
                    &lt;Items&gt;
						&lt;PlaylistItem&gt;
							&lt;AudioCodec&gt;Wma&lt;/AudioCodec&gt;
							&lt;Description&gt;&lt;/Description&gt;
							&lt;FileSize&gt;12342727&lt;/FileSize&gt;
							&lt;FrameRate&gt;15.000015000015&lt;/FrameRate&gt;
							&lt;Height&gt;768&lt;/Height&gt;
							&lt;IsAdaptiveStreaming&gt;false&lt;/IsAdaptiveStreaming&gt;
							&lt;MediaSource&gt;http://wadewegner.blob.core.windows.net/wmvs/AutostartWCF.wmv&lt;/MediaSource&gt;
							&lt;ThumbSource&gt;&lt;/ThumbSource&gt;
							&lt;Title&gt;Autostart WCF Services for Service Bus Connectivity&lt;/Title&gt;
							&lt;VideoCodec&gt;VC1&lt;/VideoCodec&gt;
							&lt;Width&gt;1024&lt;/Width&gt;
						&lt;/PlaylistItem&gt;
                    &lt;/Items&gt;
                &lt;/Playlist&gt;" />            <!--  unused valid silverlight init parameters
    <param name="enableFrameRateCounter" value="bool" />
    <param name="enableRedrawRegions" value="bool" />
    <param name="maxFrameRate" value="int" />
    <param name="allowHtmlPopupWindow" value="bool"/>
    <param name="background" value="colorValue"/>
    <param name="splashScreenSource" value="uri"/>
    <param name="fullScreen" value="bool"/>
    <param name="onFullScreenChanged" value="functionname"/>
    <param name="onResize" value="functionname"/>
    <param name="onSourceDownloadComplete" value="functionname"/>
    <param name="onSourceDownloadProgressChanged" value="functionname"/>
    <param name="windowLess" value="bool"/>
        -->           <div onmouseover="highlightDownloadArea(true)" onmouseout="highlightDownloadArea(false)">             <img src="" style="position:absolute;width:100%;height:100%;border-style:none;" onerror="this.style.display='none'" />             <img src="Preview.png" style="position:absolute;width:100%;height:100%;border-style:none;" onerror="this.style.display='none'" />                                                         <div id="overlay" class="fadeLots" style="position:absolute;width:100%;height:100%;border-style:none;background-color:white;"/></div>             <table width="100%" height="100%" style="position:absolute;"><tr><td align="center" valign="middle">                                    <img src="http://go2.microsoft.com/fwlink/?LinkId=108181" alt="Get Microsoft Silverlight">              </td></tr></table>                                <a href="http://go2.microsoft.com/fwlink/?LinkID=124807">                 <img src="" class="fadeCompletely" style="position:absolute;width:100%;height:100%;border-style:none;" alt="Get Microsoft Silverlight" />             </a>                            </div>              </object><!--end_raw-->  <p><a href="http://msdn.microsoft.com/en-us/library/ee677260.aspx" target="_blank">Windows Server AppFabric Autostart</a> is a feature introduced in Windows 7 and Windows Server 2008 R2.&#160; The primary use cases are for reducing the latency incurred by the first message and to host WCF transports/protocols for which their are no listener adapters.&#160; As you can see, initializing the host so that it connects to the Service Bus is another benefit.</p>  <p>To set this up, ensure that you have installed Windows Server AppFabric on your machine.&#160; I personally recommend you use the <a href="http://www.microsoft.com/web/downloads/platform.aspx" target="_blank">Web Platform Installer</a> to do this for you (I detail how to do this in the first part of my post on <a href="http://www.wadewegner.com/2010/08/getting-started-with-windows-server-appfabric-cache/" target="_blank">Getting Started with Windows Server AppFabric Cache</a>).&#160; Once you have this installed, follow these steps:</p>  <ol>   <li>Open <strong>IIS Manager</strong>.&#160; Navigate to your web application. </li>    <li>Click on <strong>Configure</strong> in Actions pane. </li>    <li>Configure the application to either autostart all the services by choosing <strong>Enabled</strong> or specific services by choosing <strong>Custom</strong>. </li>    <li>If you specified <strong>Custom</strong>, navigate to the configuration panel for that specific service and turn autostart to <strong>Enabled</strong>. </li> </ol>  <p>Pretty straightforward.&#160; I think you’ll like this solution, as it keeps everything within the AppFabric family.</p>
