--- 
layout: post
title: Deploying Your Services from the Windows Azure Toolkit for Windows Phone 7
categories: 
- Toolkit
- Windows Azure
- Windows Phone 7
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "1"
  disable_wpautop: "1"
  disable_wptexturize: "0"
  disable_convert_chars: "0"
  disable_convert_smilies: "0"
  _wp_old_slug: deploying-the-services-from-the-windows-azure-toolkit-for-windows-phone-7
  dsq_thread_id: "610355014"
---
<p>One of the most common requests I’ve received for the <a href="http://watoolkitwp7.codeplex.com/" target="_blank">Windows Azure Toolkit for Windows Phone 7</a> has been a tutorial for deploying the services to Windows Azure.&#160; It’s taken longer than it should have—my humblest apologies—but I’ve finally put one together.&#160; You’ll need to follow the following steps outlined below:</p>  <ul>   <li>Create a Certificate (used for SSL) </li>    <li>Export the PFX File </li>    <li>Upload the PFX File to Windows Azure </li>    <li>(optional) Supporting Apple Push Notifications </li>    <li>Update and Deploy to Windows Azure </li>    <li>Update Your Windows Phone Project </li> </ul>  <p>If you have any problems or confusion regarding the steps below, please let me know.</p> <strong></strong>  <p><strong>Create a Certificate</strong></p>  <ol>   <li>Open the <strong>Visual Studio Command Prompt</strong> window as an administrator. </li>    <li>Change the directory to the location where you want to save the certificate file. </li>    <li>Type the following command, making sure to replace &lt;<em>CertificateName&gt;</em> with your hosted service URL:       <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper">       <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet">         <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: &#39;Courier New&#39;, courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">makecert -sky exchange -r -n &quot;CN=<span style="color: #0000ff">&lt;</span><span style="color: #800000">CertificateName</span><span style="color: #0000ff">&gt;</span>&quot; -pe -a sha1 -len 2048 -ss My &quot;<span style="color: #0000ff">&lt;</span><span style="color: #800000">CertificateName</span><span style="color: #0000ff">&gt;</span>.cer&quot;</pre>
      </div>
    </div>

    <div>For example:</div>

    <div><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image24.png" width="624" height="116" /></div>

    <div><strong>Note:</strong> The <strong>makecert</strong> tool will both create the .cer file and register the certificate in your Personal Certificates store. For more information, check the following article: <a href="http://msdn.microsoft.com/en-us/library/gg432987.aspx">http://msdn.microsoft.com/en-us/library/gg432987.aspx</a>.</div>
  </li>
</ol>

<div><strong></strong></div>

<p><strong>Export the PFX File</strong></p>

<ol>
  <li>Open the Certificate Manager snap-in for the management console by typing <strong>certmgr.msc</strong> in the <strong>Start</strong> menu textbox.

    <br /><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="4" border="0" alt="4" src="http://images.wadewegner.com/wordpress/2011/05/4.png" width="682" height="294" /> </li>

  <li>The new certificate was automatically added to the personal certificate store. Export the certificate by right-clicking it, pointing to <strong>All Tasks</strong>, and then clicking <strong>Export</strong>. </li>

  <li>On the <strong>Export Private Key</strong> page, make sure to select <strong>Yes, export the private key</strong>. 

    <div><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image17.png" width="513" height="466" /></div>
  </li>

  <li>Choose a name and export the file to a .pfx file. 
    <p><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image18.png" width="513" height="466" /></p>
  </li>

  <li>Finish the wizard. 
    <div><strong>Note:</strong> You now have a copy of the certificate (.pfx) with the private key. For more information, check the following article: <a href="http://msdn.microsoft.com/en-us/library/gg432987.aspx">http://msdn.microsoft.com/en-us/library/gg432987.aspx</a>.</div>
  </li>
</ol>

<div><strong></strong></div>

<p><strong>Upload the PFX File to Windows Azure</strong></p>

<ol>
  <li>Open a browser, navigate to the Windows Azure Platform Management Portal at <a href="https://windows.azure.com">https://windows.azure.com</a> and log in with your credentials. </li>

  <li>Select <strong>Hosted Services, Storage Accounts &amp; CDN</strong> and then <strong>Hosted Services</strong>. </li>

  <li>Expand your hosted service project, and select the <strong>Certificates</strong> folder. 

    <div><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image19.png" width="624" height="409" /></div>
  </li>

  <li>Click <strong>Add Certificate</strong>. </li>

  <li>Click <strong>Browse</strong> and select the PFX file you saved. Enter the password, and click <strong>Create</strong>. 

    <div><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image20.png" width="539" height="236" /></div>
  </li>

  <li>Once the certificate has been uploaded and created, copy the <strong>Thumbprint</strong> for later use. 

    <div><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image21.png" width="624" height="409" /></div>
  </li>
</ol>

<p><strong>Supporting Apple Push Notifications</strong></p>

<p>During the project creation through the project template, you are given the option to support Apple Push Notifications through the Azure Web role.</p>

<div><img style="background-image: none; border-right-width: 0px; margin: 0px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image22.png" width="634" height="342" /></div>

<p>If you chose to support Apple Push Notifications, please follow these additional steps:</p>

<ol>
  <li>In order to use the toolkit to send Apple push notifications, you should have obtained the appropriate SSL certificate for your iOS application. You can find more information on how to obtain an Apple development certificate in the <a href="http://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/ProvisioningDevelopment/ProvisioningDevelopment.html">Provisioning and Development</a> article in the <a href="http://developer.apple.com/library/ios/documentation/NetworkingInternet/Conceptual/RemoteNotificationsPG/Introduction/Introduction.html">Local and Push Notification Programming Guide</a>. </li>

  <li>Upload the same Apple development certificate selected during the project template wizard to your hosted service. To do this, you can follow the same steps required to upload the SSL certificate described in the previous section. </li>
</ol>

<p><strong>Update and Deploy to Windows Azure</strong></p>

<ol>
  <li>In the Windows Azure Project, double-click the role (e.g. WP7CloudApp1.Web) to open the role properties. </li>

  <li>Select the <strong>Settings</strong> tab and update the <strong>DataConnectionString</strong> and <strong>Microsoft.WindowsAzure.Plugins.Diagnostics.ConnectionString</strong> to point to your production storage account. </li>

  <li>Select the <strong>Certificates</strong> tab, and set the <strong>SslCertificate</strong> property value to the <strong>Thumbprint</strong> you saved from the Windows Azure portal. This will replace the thumbprint for the localhost certificate with the thumbprint related to the certificate you uploaded into your hosted service. </li>

  <li>Add the .cer file to your web application project. This way, you can point your phone users to download the certificate and install into the emulator. Right-click on the Web application project, choose Add Existing Item, select the .cer file you previously created, and add it to the project. </li>

  <li>Open the .cer file properties and make sure that the <strong>Build Action</strong> is set to <strong>Content</strong>. 

    <div><img style="background-image: none; border-right-width: 0px; margin: 5px 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" src="http://images.wadewegner.com/wordpress/2011/05/image23.png" width="374" height="384" /></div>
  </li>

  <li>Now you can publish your Windows Azure project to your hosted service. You can do this from the Windows Azure Platform Management Portal or directly from Visual Studio 2010. </li>
</ol>

<p><strong>Update Your Windows Phone Project to Consume Your Windows Azure Hosted Service</strong></p>

<ol>
  <li>In your Windows Phone project, open the <strong>App.xaml</strong> file. </li>

  <li>Update the following resources: 
    <table border="1" cellspacing="0" cellpadding="5" width="745"><tbody>
        <tr>
          <td valign="top" width="275">
            <div><strong>Key</strong></div>
          </td>

          <td valign="top" width="468">
            <div><strong>Value</strong></div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>SSLCertificateUrl</strong></div>
          </td>

          <td valign="top" width="468">
            <div>http://<strong>&lt;YourDNSPrefix&gt;</strong>.cloudapp.net:10080/<strong>&lt;CertificateName&gt;</strong>.cer</div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>SharedAccessSignatureServiceEndpoint</strong></div>
          </td>

          <td valign="top" width="468">
            <div>https://<strong> &lt;YourDNSPrefix&gt;</strong>.cloudapp.net/SharedAccessSignatureService</div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>AzureStorageTableProxyEndpoint</strong></div>
          </td>

          <td valign="top" width="468">
            <div>https://<strong> &lt;YourDNSPrefix&gt;</strong>.cloudapp.net/AzureTablesProxy.axd</div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>AzureStorageQueueProxyEndpoint</strong></div>
          </td>

          <td valign="top" width="468">
            <div>https://<strong> &lt;YourDNSPrefix&gt;</strong>.cloudapp.net/AzureQueuesProxy.axd</div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>AuthenticationServiceEndpoint</strong></div>
          </td>

          <td valign="top" width="468">
            <div>https://<strong> &lt;YourDNSPrefix&gt;</strong>.cloudapp.net/AuthenticationService</div>
          </td>
        </tr>

        <tr>
          <td valign="top" width="275">
            <div><strong>PushNotificationServiceEndpoint</strong></div>
          </td>

          <td valign="top" width="468">
            <div>https://<strong> &lt;YourDNSPrefix&gt;</strong>.cloudapp.net/PushNotificationService</div>
          </td>
        </tr>
      </tbody></table>
  </li>

  <li>To test against the deployed services, right-click the Windows Phone project, navigate to the <strong>Debug</strong> context menu, and click on <strong>Start new instance</strong>. </li>
</ol>

<p>I hope this helps!</p>
