--- 
layout: post
title: Web Deploy with Windows Azure on Restrictive Networks
categories: 
- Web Deploy
- Windows Azure
tags: []

status: publish
type: post
published: true
meta: 
  disable_wpautop: "1"
  _edit_last: "1"
  disable_wptexturize: "0"
  disable_convert_chars: "0"
  disable_convert_smilies: "0"
  dsq_thread_id: "609466282"
---
<p>Some networks are more restrictive than others, and (much to my continual chagrin) this is especially true here at Microsoft.&#160; As I wrote and tested the post <a href="http://www.wadewegner.com/2010/12/using-web-deploy-with-windows-azure-for-rapid-development/" target="_blank">Using Web Deploy with Windows Azure for Rapid Development</a>, I found that I was not able to use Web Deploy on port 8172; turns out that we prevent SSL traffic on any port but 443.&#160; Fortunately, it’s pretty easy to resolve this restriction by modifying the <a href="http://msdn.microsoft.com/en-us/library/ee758711(en-us).aspx#InputEndpoints" target="_blank">Input Endpoint values in the Service Definition</a>.</p>  <p>Essentially, we need to map an external port (e.g. the port to which you will publish) to a local portal on the machine (e.g. the port with which Web Deploy listens).&#160; On the Microsoft network, this means that I’ll publish to port 443 but need it to resolve to a local port of 8172.</p>  <p>Before starting, review my post on <a href="http://www.wadewegner.com/2010/12/using-web-deploy-with-windows-azure-for-rapid-development/" target="_blank">using Web Deploy with Windows Azure</a>.&#160; There are only two differences, as noted below.</p>  <p>First, update the <strong>InputEndpoint</strong> values in your Service Definition file (ServiceDefinition.csdef) to map the external port to a local port.</p>    <p>   <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:91e8ca36-7d90-4b71-a992-cbc7de8e8d35" class="wlWriterEditableSmartContent"> <div class="le-pavsc-container"> <div class="le-pavsc-titleblock">Code: InputEndpoint</div> <div style="background: #ddd; overflow: auto"> <ol style="background: #ffffff; margin: 0 0 0 2em; padding: 0 0 0 5px;"> <li><span style="color:#0000ff">&lt;</span><span style="color:#a31515">InputEndpoint</span><span style="color:#0000ff"> </span><span style="color:#ff0000">name</span><span style="color:#0000ff">=</span>&quot;<span style="color:#0000ff">mgmtsvc</span>&quot;<span style="color:#0000ff"> </span><span style="color:#ff0000">protocol</span><span style="color:#0000ff">=</span>&quot;<span style="color:#0000ff">tcp</span>&quot;<span style="color:#0000ff"> </span><span style="color:#ff0000">port</span><span style="color:#0000ff">=</span>&quot;<span style="color:#0000ff">443</span>&quot;<span style="color:#0000ff"> </span><span style="color:#ff0000">localPort</span><span style="color:#0000ff">=</span>&quot;<span style="color:#0000ff">8172</span>&quot;<span style="color:#0000ff"> /&gt;</span></li> </ol> </div> </div> </div> </p>  <p>Second, after you’ve deployed to Windows Azure and your instance is up and running, you’ll need to update your publish settings for Web Deploy – specifically, the <strong>Service URL</strong>.&#160; Here are the values that I’ve gotten to work:</p>  <p><img style="background-image: none; border-bottom: 0px; border-left: 0px; margin: ; padding-left: 0px; padding-right: 0px; display: inline; border-top: 0px; border-right: 0px; padding-top: 0px" title="WebDeployOn443" border="0" alt="WebDeployOn443" src="http://images.wadewegner.com/wordpress/2010/12/WebDeployOn443.png" width="470" height="633" /></p>  <p>The screen shot cuts off the service URL.&#160; The full URL is:</p>  <ol>   <p>https://<font style="background-color: #ffff00"><strong>mywebdeploy</strong></font>.cloudapp.net:<font style="background-color: #ffff00"><strong>443</strong></font>/msdeploy.axd</p> </ol>  <p>Of course, you’ll need to update these values to your DNS name and the port to which you’ll deploy.</p>
