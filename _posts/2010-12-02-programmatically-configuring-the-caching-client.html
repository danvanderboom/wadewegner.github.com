--- 
layout: post
title: Programmatically Configuring the Caching Client
categories: 
- Caching
- Windows Azure AppFabric
tags: []

status: publish
type: post
published: true
meta: 
  _edit_last: "1"
  disable_wpautop: "1"
  disable_wptexturize: "0"
  disable_convert_chars: "0"
  disable_convert_smilies: "0"
  dsq_thread_id: "609465913"
---
<p>When using <a href="http://www.microsoft.com/en-us/appfabric/azure/middleware-services.aspx#Caching" target="_blank">Windows Azure AppFabric Caching</a> you will have to configure the caching client to use a provisioned cache.&#160; In the past I’ve given examples of doing this <a href="http://www.wadewegner.com/2010/11/code-for-the-windows-azure-appfabric-caching-demo/" target="_blank">using an application configuration file</a>, but there are times where you may want to programmatically configure the caching client.&#160; Fortunately, it’s really quite easy and straight forward.</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:9ce6104f-a9aa-4a17-a79f-3a39532ebf7c:d6598d1b-4393-4066-b21b-9ef9b7a741dc" class="wlWriterSmartContent">   <div class="le-pavsc-container">     <div class="le-pavsc-titleblock">Caching Client Code</div>      <div style="background: #ddd; overflow: auto">       <ol style="padding-bottom: 0px; margin: 0px 0px 0px 2.5em; padding-left: 5px; padding-right: 0px; background: #ffffff; padding-top: 0px">         <li><span style="color: #008000">// define the cache details</span> </li>          <li class="even"><span style="color: #0000ff">string</span> serviceUrl = <span style="color: #a31515">&quot;YOURNAMESPACE.cache.appfabriclabs.com&quot;</span>; </li>          <li><span style="color: #0000ff">string</span> authorizationToken = <span style="color: #a31515">&quot;YOURTOKEN&quot;</span>; </li>          <li class="even">&#160; </li>          <li><span style="color: #008000">// declare an array for the cache host</span> </li>          <li class="even"><span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">DataCacheServerEndpoint</span>&gt; server = <span style="color: #0000ff">new</span> <span style="color: #2b91af">List</span>&lt;<span style="color: #2b91af">DataCacheServerEndpoint</span>&gt;(); </li>          <li>server.Add(<span style="color: #0000ff">new</span> <span style="color: #2b91af">DataCacheServerEndpoint</span>(serviceUrl, 22233)); </li>          <li class="even">&#160; </li>          <li><span style="color: #008000">// setup the DataCacheFactory configuration</span> </li>          <li class="even"><span style="color: #2b91af">DataCacheFactoryConfiguration</span> conf = <span style="color: #0000ff">new</span> <span style="color: #2b91af">DataCacheFactoryConfiguration</span>(); </li>          <li>conf.IsRouting = <span style="color: #0000ff">false</span>; </li>          <li class="even">conf.SecurityProperties = <span style="color: #0000ff">new</span> <span style="color: #2b91af">DataCacheSecurity</span>(authorizationToken); </li>          <li>conf.Servers = server; </li>          <li class="even">conf.RequestTimeout = <span style="color: #0000ff">new</span> <span style="color: #2b91af">TimeSpan</span>(0, 0, 45); </li>          <li>conf.ChannelOpenTimeout = <span style="color: #0000ff">new</span> <span style="color: #2b91af">TimeSpan</span>(0, 0, 45); </li>          <li class="even">&#160; </li>          <li><span style="color: #008000">// create the DataCacheFactor based on config settings</span> </li>          <li class="even"><span style="color: #2b91af">DataCacheFactory</span> dataCacheFactory = <span style="color: #0000ff">new</span> <span style="color: #2b91af">DataCacheFactory</span>(conf); </li>          <li>&#160; </li>          <li class="even"><span style="color: #008000">// get the default cache client</span> </li>          <li><span style="color: #2b91af">DataCache</span> dataCache = dataCacheFactory.GetDefaultCache(); </li>          <li class="even">&#160; </li>          <li><span style="color: #008000">// put and retrieve a test object</span> </li>          <li class="even">dataCache.Put(<span style="color: #a31515">&quot;key&quot;</span>, <span style="color: #a31515">&quot;1&quot;</span>); </li>          <li><span style="color: #0000ff">string</span> value = dataCache.Get(<span style="color: #a31515">&quot;key&quot;</span>) <span style="color: #0000ff">as</span> <span style="color: #0000ff">string</span>; </li>          <li class="even">&#160; </li>          <li><span style="color: #2b91af">Console</span>.WriteLine(<span style="color: #a31515">&quot;Your value: &quot;</span> + value); </li></ol></div></div></div> <p>   <br />Here are some of the more interesting pieces:</p>  <ul>   <li>Line 6: Create a <font size="2" face="Courier New">DataCacheServerEndpoint</font> list that will be used in the <font size="2" face="Courier New">DataCacheFactoryConfiguration</font> (see line 13). </li>    <li>Line 7: Add the endpoint (defined by the service URL and port) to the list. </li>    <li>Line 12: Set a <font size="2" face="Courier New">DataCacheSecurity </font>object using the authorization token for the <font size="2"><font face="Courier New">SecurityProperties</font> </font>property. </li>    <li>Line 13: Set the <font size="2" face="Courier New">DataCacheServerEndpoint</font> list to the <font size="2" face="Courier New">Servers</font> property. </li>    <li>Line 18: Create a new <font size="2" face="Courier New">DataCacheFactory</font> and pass the <font size="2" face="Courier New">DataCacheFactoryConfiguration</font> object to the constructor. </li> </ul>  <p>Before getting started, but sure to <a href="http://msdn.microsoft.com/en-us/library/gg278344.aspx" target="_blank">prepare Visual Studio</a> and <a href="http://msdn.microsoft.com/en-us/library/gg278349.aspx" target="_blank">provision or access</a> your Cache to get the service URL and the authorization token.</p>
